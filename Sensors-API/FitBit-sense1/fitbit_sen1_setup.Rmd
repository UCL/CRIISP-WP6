---
title: "Fitbit API"
output: 
  github_document:
    toc: True
date: "`r format(Sys.time(), '%d %B, %Y')`"
---
```{r echo=F}
library("fitbitr")
library("reticulate")
#py_install("fitbit")

```

## Use

### Callback URL

Note: when setting up an app, the Callback URL should be set to http://localhost:1410/. This is not supposed to be allowed, but it does seems to work. This is handy because allows for the callback to be (e.g.) on a laptop for testing.

```{r eval=FALSE}
#devtools::install_github("mrkaye97/fitbitr")

FITBIT_CLIENT_ID <- "23RBL4"
FITBIT_CLIENT_SECRET <- "5584bef963882c9134273b0f77574bb5"
CALLBACK_URL<-"http://localhost:1410/"
authorization_URI<-"https://www.fitbit.com/oauth2/authorize"
Token_Request_URI<-"https://api.fitbit.com/oauth2/token"

library("fitbitr")

APP_NAME<-"sense1_test"

fitbitr_token <- generate_fitbitr_token(
  client_id = FITBIT_CLIENT_ID,
  client_secret = FITBIT_CLIENT_SECRET,
  callback = CALLBACK_URL,
  cache = TRUE
)

```
## ACTIVITY
```{r}

# Example date
date <- "2023-10-16"
get_activity_summary(date)

df <- get_activity_intraday_time_series(token, "steps", date, detail_level="15min")
df$time <- as.POSIXct(strptime(paste0(df$dateTime, " ", df$dataset_time), "%Y-%m-%d %H:%M:%S"))
ggplot2::ggplot(df, aes(x=time, y=dataset_value)) + geom_line()
```
